<!DOCTYPE html> 
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tallennetut Tapahtumat</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module" src="app.js" defer></script>
</head>
<body>
    <nav>
        <ul>
            <li><a href="index.html">Etusivu</a></li>
            <li><a href="events.html">Tapahtumat</a></li>
            <li><a href="add-event.html">Lisää Tapahtuma</a></li>
            <li><a href="saved-events.html">Tallennetut Tapahtumat</a></li>
        </ul>
    </nav>

    <header>
        <h1>Tallennetut Tapahtumat</h1>
    </header>

    <section id="savedEvents">
        <p>Haetaan tapahtumia...</p>
    </section>

    <footer>
        <p>&copy; 2024 Paikalliset Tapahtumat</p>
    </footer>

    <script>
        import { getAuth } from "firebase/auth";
        import { getFirestore, collection, query, where, getDocs } from "firebase/firestore";
        import { initializeApp } from "firebase/app";

        const firebaseConfig = {
            apiKey: "AIzaSyCxQkJ9T7UZshu-o8KNBhdMA2AfIBY-YUM",
            authDomain: "pilvi-react-59c31.firebaseapp.com",
            projectId: "pilvi-react-59c31",
            storageBucket: "pilvi-react-59c31.firebasestorage.app",
            messagingSenderId: "485543190012",
            appId: "1:485543190012:web:22c3225d4ad02e7b40e679"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        const savedEventsSection = document.getElementById("savedEvents");

        const fetchSavedEvents = async () => {
            const user = auth.currentUser;
            if (user) {
                try {
                    const q = query(collection(db, "events"), where("userId", "==", user.uid));
                    const querySnapshot = await getDocs(q);
                    
                    // Jos tapahtumia löytyy
                    if (!querySnapshot.empty) {
                        querySnapshot.forEach((doc) => {
                            const eventData = doc.data();
                            const eventElement = document.createElement("div");
                            eventElement.innerHTML = `
                                <h3>${eventData.name}</h3>
                                <p>${eventData.date}</p>
                                <p>${eventData.location}</p>
                            `;
                            savedEventsSection.appendChild(eventElement);
                        });
                    } else {
                        savedEventsSection.innerHTML = "<p>Ei tallennettuja tapahtumia.</p>";
                    }
                } catch (error) {
                    savedEventsSection.innerHTML = "<p>Tapahtumia ei voitu ladata. Yritä uudelleen.</p>";
                }
            } else {
                savedEventsSection.innerHTML = "<p>Et ole kirjautunut sisään.</p>";
            }
        };

        fetchSavedEvents();
    </script>
</body>
</html>
