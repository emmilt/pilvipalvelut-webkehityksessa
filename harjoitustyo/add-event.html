<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lisää Tapahtuma</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module" src="app.js"></script>
</head>
<body>
    <nav>
        <ul>
            <li><a href="index.html">Etusivu</a></li>
            <li><a href="events.html">Tapahtumat</a></li>
            <li><a href="add-event.html">Lisää Tapahtuma</a></li>
            <li><a href="login.html">Kirjaudu sisään</a></li>
        </ul>
    </nav>

    <header>
        <h1>Lisää Tapahtuma</h1>
    </header>

    <section>
        <form id="addEventForm">
            <label for="eventName">Tapahtuman Nimi:</label>
            <input type="text" id="eventName" required><br>
            <label for="eventDate">Päivämäärä:</label>
            <input type="date" id="eventDate" required><br>
            <label for="eventLocation">Paikka:</label>
            <input type="text" id="eventLocation" required><br>
            <button type="submit">Lisää Tapahtuma</button>
        </form>
        <div id="confirmationMessage"></div>
    </section>

    <footer>
        <p>&copy; 2024 Paikalliset Tapahtumat</p>
    </footer>

    <script>
        import { getAuth } from "../firebase/auth";
        import { getFirestore, collection, addDoc } from "firebase/firestore";
        import { initializeApp } from "firebase/app";

        const firebaseConfig = {
            apiKey: "AIzaSyCxQkJ9T7UZshu-o8KNBhdMA2AfIBY-YUM",
            authDomain: "pilvi-react-59c31.firebaseapp.com",
            projectId: "pilvi-react-59c31",
            storageBucket: "pilvi-react-59c31.firebasestorage.app",
            messagingSenderId: "485543190012",
            appId: "1:485543190012:web:22c3225d4ad02e7b40e679"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        document.getElementById("addEventForm").addEventListener("submit", async (event) => {
            event.preventDefault();

            const eventName = document.getElementById("eventName").value;
            const eventDate = document.getElementById("eventDate").value;
            const eventLocation = document.getElementById("eventLocation").value;
            const user = auth.currentUser;

            if (user) {
                try {
                    await addDoc(collection(db, "events"), {
                        name: eventName,
                        date: eventDate,
                        location: eventLocation,
                        userId: user.uid
                    });
                    document.getElementById("confirmationMessage").innerHTML = "<p>Tapahtuma lisätty onnistuneesti!</p>";
                    window.location.href = "events.html";
                } catch (e) {
                    document.getElementById("confirmationMessage").innerHTML = "<p>Virhe tapahtuman lisäyksessä. Yritä uudelleen!</p>";
                }
            } else {
                document.getElementById("confirmationMessage").innerHTML = "<p>Et ole kirjautunut sisään. Kirjaudu ensin!</p>";
            }
        });
    </script>
</body>
</html>
